{"status":{},"contains_secrets":false,"product_version":"3.3.1","spec":{"description":"Create a disk image from a VM","resources":{"endpoints_information":[{"description":"","endpoint_reference":{"kind":"app_endpoint","name":"PrismElement"}}],"endpoint_definition_list":[],"credential_definition_list":[{"username":"admin","description":"","type":"PASSWORD","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"name":"admin","cred_class":"static"}],"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"GetVM"},{"kind":"app_task","name":"GetDiskDetails"},{"kind":"app_task","name":"SetDiskUUID"},{"kind":"app_task","name":"VMStateDecision"},{"kind":"app_task","name":"CreateImage"},{"kind":"app_task","name":"LoopTaskStatus"},{"kind":"app_task","name":"PowerON_SourceVM"}],"name":"d1c4b342_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"VMStateDecision"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"CreateImage"}},{"from_task_reference":{"kind":"app_task","name":"CreateImage"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"LoopTaskStatus"}},{"from_task_reference":{"kind":"app_task","name":"LoopTaskStatus"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"PowerON_SourceVM"}},{"from_task_reference":{"kind":"app_task","name":"SetDiskUUID"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"VMStateDecision"}},{"from_task_reference":{"kind":"app_task","name":"GetDiskDetails"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"SetDiskUUID"}},{"from_task_reference":{"kind":"app_task","name":"GetVM"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"GetDiskDetails"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"PrismElement"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"GetVM","attrs":{"expected_response_params":[{"status":"SUCCESS","code":200,"type":""},{"status":"FAILURE","code":500,"type":""},{"status":"FAILURE","code":400,"type":""}],"relative_url":"vms\/","request_body":"","headers":[],"url":"","response_paths":{"VM_State":"$.entities[?(@.name=='@@{VM_Name}@@')].power_state","VM_UUID":"$.entities[?(@.name=='@@{VM_Name}@@')].uuid"},"retry_interval":10,"method":"GET","retry_count":1,"authentication":{"type":"none"},"tls_verify":false,"content_type":"application\/json","connection_timeout":120,"type":"","proxy_type":""},"timeout_secs":"0","type":"HTTP","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"PrismElement"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"GetDiskDetails","attrs":{"expected_response_params":[{"status":"SUCCESS","code":200,"type":""},{"status":"FAILURE","code":500,"type":""}],"relative_url":"vms\/@@{AZ_LOAD_JSON(VM_UUID)[0]}@@?include_vm_disk_config=true","request_body":"","headers":[],"url":"","response_paths":{"DISK_UUID":"$.vm_disk_info[?(@.disk_address.disk_label==\"scsi.0\")]..vmdisk_uuid"},"retry_interval":10,"method":"GET","retry_count":1,"authentication":{"type":"none"},"tls_verify":false,"content_type":"application\/json","connection_timeout":120,"type":"","proxy_type":""},"timeout_secs":"0","type":"HTTP","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"SetDiskUUID","attrs":{"exit_status":[],"script":"diskArray = '@@{DISK_UUID}@@'\ndiskUUID = diskArray.replace('[','').replace(']','').replace('\"','')\nprint('VMDISK_UUID=' + diskUUID)","eval_variables":["VMDISK_UUID"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"VMStateDecision","attrs":{"failure_child_reference":{"kind":"app_task","name":"6a1473b1_FAILURE_META"},"exit_status":[],"script":"stateRef = 'off'\nstateSrc = '@@{AZ_LOAD_JSON(VM_State)[0]}@@'\nif stateSrc == stateRef:\n  exit(0)\nelse:\n  exit(1)","success_child_reference":{"kind":"app_task","name":"db37d3a2_SUCCESS_META"},"type":"","command_line_args":"","script_type":"static"},"timeout_secs":"0","type":"DECISION","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Wait"}],"name":"db37d3a2_SUCCESS_META","attrs":{"type":""},"timeout_secs":"0","type":"META","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Wait","attrs":{"type":"","interval_secs":1},"timeout_secs":"0","type":"DELAY","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ShutdownVM"},{"kind":"app_task","name":"WaitShutdown"}],"name":"6a1473b1_FAILURE_META","attrs":{"type":""},"timeout_secs":"0","type":"META","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"PrismElement"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ShutdownVM","attrs":{"expected_response_params":[{"status":"SUCCESS","code":200,"type":""},{"status":"FAILURE","code":500,"type":""}],"relative_url":"vms\/@@{AZ_LOAD_JSON(VM_UUID)[0]}@@\/set_power_state\/","request_body":"{\"transition\":\"OFF\"}","headers":[],"url":"","response_paths":{},"retry_interval":10,"method":"POST","retry_count":1,"authentication":{"type":"none"},"tls_verify":false,"content_type":"application\/json","connection_timeout":120,"type":"","proxy_type":""},"timeout_secs":"0","type":"HTTP","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WaitShutdown","attrs":{"type":"","interval_secs":60},"timeout_secs":"0","type":"DELAY","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"PrismElement"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"CreateImage","attrs":{"expected_response_params":[{"status":"SUCCESS","code":200,"type":""},{"status":"FAILURE","code":500,"type":""},{"status":"FAILURE","code":400,"type":""}],"relative_url":"\/images\/","request_body":"{\"annotation\":\"@@{Image_Name}@@\",\"image_type\":\"DISK_IMAGE\",\"name\":\"@@{Image_Name}@@\",\"vm_disk_clone_spec\":{\"disk_address\":{\"device_bus\":\"SCSI\",\"vmdisk_uuid\":\"@@{VMDISK_UUID}@@\"}}}","headers":[],"url":"","response_paths":{"TASK_UUID":"$.task_uuid"},"retry_interval":10,"method":"POST","retry_count":1,"authentication":{"type":"none"},"tls_verify":false,"content_type":"application\/json","connection_timeout":120,"type":"","proxy_type":""},"timeout_secs":"0","type":"HTTP","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"7df2a5cc_1_META"}],"name":"LoopTaskStatus","attrs":{"loop_variable":"TASK_State","exit_condition_type":"on_success","type":"","iterations":"20"},"timeout_secs":"0","type":"WHILE_LOOP","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"GettaskStatus"},{"kind":"app_task","name":"Compare_Status"}],"name":"7df2a5cc_1_META","attrs":{"type":""},"timeout_secs":"0","type":"META","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"PrismElement"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"GettaskStatus","attrs":{"expected_response_params":[{"status":"SUCCESS","code":200,"type":""},{"status":"FAILURE","code":400,"type":""},{"status":"FAILURE","code":500,"type":""}],"relative_url":"tasks\/@@{TASK_UUID}@@","request_body":"","headers":[],"url":"","response_paths":{"TASK_Status":"$.progress_status"},"retry_interval":10,"method":"GET","retry_count":1,"authentication":{"type":"none"},"tls_verify":false,"content_type":"application\/json","connection_timeout":120,"type":"","proxy_type":""},"timeout_secs":"0","type":"HTTP","variable_list":[]},{"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Compare_Status","attrs":{"script":"taskStatus = '@@{TASK_Status}@@'\nrefStatus = 'Succeeded'\nif taskStatus == refStatus:\n   exit(0)\nelse:\n   exit(1)\n","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_endpoint","name":"PrismElement"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"PowerON_SourceVM","attrs":{"expected_response_params":[{"status":"SUCCESS","code":200,"type":""},{"status":"FAILURE","code":500,"type":""},{"status":"FAILURE","code":400,"type":""}],"relative_url":"vms\/@@{AZ_LOAD_JSON(VM_UUID)[0]}@@\/set_power_state\/","request_body":"{\"transition\":\"ON\"}","headers":[],"url":"","response_paths":{},"retry_interval":10,"method":"POST","retry_count":1,"authentication":{"type":"none"},"tls_verify":false,"content_type":"application\/json","connection_timeout":120,"type":"","proxy_type":""},"timeout_secs":"0","type":"HTTP","variable_list":[]}],"description":"","name":"88c94b7f_runbook","main_task_local_reference":{"kind":"app_task","name":"d1c4b342_dag"},"variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"VMDISK_UUID","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DISK_UUID","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"VM_UUID","value":"","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"Image_Name","value":"Debian_ModeleRunbook","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"VM_Name","value":"Debian_Modele","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]},"client_attrs":{},"default_target_reference":{"kind":"app_endpoint","name":"PrismElement"}},"name":"CreateImageFromVM"},"api_version":"3.0","metadata":{"last_update_time":"1640336711701094","kind":"runbook","spec_version":136,"creation_time":"1640248016774132","name":"CreateImageFromVM"}}